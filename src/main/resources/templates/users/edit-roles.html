<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{common/layout}">

<head>
    <meta charset="UTF-8">
    <title>権限変更</title>
</head>

<body>
    <div layout:fragment="content" class="container mt-5" style="max-width: 400px;">

        <!-- タイトル -->
        <h2 class="text-center mb-4">権限変更</h2>

        <!-- 成功メッセージ -->
        <div th:if="${success}" class="alert alert-success text-center" th:text="${success}"></div>

        <!-- 権限変更フォーム -->
        <form th:action="@{/users/edit-roles}" th:object="${rolesForm}" method="post"
            class="border rounded p-4 shadow-sm bg-light">

            <!-- ユーザーID（hidden） -->
            <input type="hidden" name="id" th:value="*{id}" />

            <!-- 権限選択 -->
            <div class="mb-3">
                <label for="roles" class="form-label fw-semibold">新しい権限</label>
                <select id="roles" name="roles" th:value="*{roles}" class="form-select">
                    <option value="" selected disabled>-- 権限を選択 --</option>
                    <option value="ROLE_USER">一般ユーザー</option>
                    <option value="ROLE_ADMIN">管理者</option>
                </select>

                <!-- バリデーションエラー -->
                <div th:if="${#fields.hasErrors('roles')}" th:errors="*{roles}" class="text-danger mt-1"></div>
                <!-- その他エラー -->
                <div th:if="${error}" class="alert alert-danger mt-2" th:text="${error}"></div>
            </div>

            <!-- 変更ボタン -->
            <div class="d-grid">
                <button type="submit" class="btn btn-success"
                    th:disabled="${rolesForm.id == #authentication.principal.id}">
                    変更
                </button>
            </div>

            <!-- 本人判定 -->
            <p th:if="${rolesForm.id == #authentication.principal.id}" class="text-secondary small mt-2 text-center">
                ※自分自身の権限は変更できません。
            </p>

        </form>

        <!-- 戻るリンク -->
        <div class="text-center mt-4">
            <a th:href="@{/users/{id}(id=${rolesForm.id})}" class="btn btn-outline-success">ユーザー詳細に戻る</a>
        </div>

    </div>
</body>

</html>