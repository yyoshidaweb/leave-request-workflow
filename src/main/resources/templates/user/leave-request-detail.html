<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{common/layout}">

<head>
    <meta charset="UTF-8">
    <title>休暇申請詳細</title>
</head>

<body>
    <div layout:fragment="content" class="container my-5">

        <!-- タイトル -->
        <div class="text-center mb-4">
            <h2 class="fw-bold">休暇申請詳細</h2>
            <p th:if="${success}" th:text="${success}" class="text-success fw-semibold"></p>
        </div>

        <!-- 詳細カード -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow-sm border-0">
                    <div class="card-body bg-light rounded">

                        <!-- ステータス -->
                        <div class="mb-3">
                            <span class="fw-semibold">ステータス：</span>
                            <span th:switch="${leaveRequest.status.name}">
                                <span th:case="'PENDING'" th:text="${leaveRequest.status.label}"
                                    class="badge text-bg-warning shadow-sm"></span>
                                <span th:case="'APPROVED'" th:text="${leaveRequest.status.label}"
                                    class="badge text-bg-success shadow-sm"></span>
                                <span th:case="'REJECTED'" th:text="${leaveRequest.status.label}"
                                    class="badge text-bg-danger shadow-sm"></span>
                                <span th:case="'WITHDRAWN'" th:text="${leaveRequest.status.label}"
                                    class="badge text-bg-secondary shadow-sm"></span>
                                <span th:case="*" th:text="${leaveRequest.status.label}"
                                    class="badge text-bg-secondary shadow-sm"></span>
                            </span>
                        </div>

                        <!-- 休暇期間 -->
                        <div class="d-flex align-items-center mb-3">
                            <span class="me-2 fw-semibold text-muted text-nowrap">休暇期間：</span>
                            <h5 class="mb-0 fw-semibold">
                                <span th:text="${leaveRequest.startDate}"></span> 〜
                                <span th:text="${leaveRequest.endDate}"></span>
                            </h5>
                        </div>

                        <!-- 休暇種別 -->
                        <div class="mb-3">
                            <span class="fw-semibold">休暇種別：</span>
                            <span th:text="${leaveRequest.leaveType.label}"></span>
                        </div>

                        <!-- 理由 -->
                        <div class="mb-3">
                            <span class="fw-semibold">理由：</span>
                            <p class="mb-0" th:text="${leaveRequest.reason}"></p>
                        </div>

                        <!-- 管理者コメント -->
                        <div th:if="${leaveRequest.adminComment}">
                            <span class="fw-semibold">管理者コメント：</span>
                            <p class="mb-0" th:text="${leaveRequest.adminComment}"></p>
                        </div>

                        <!-- エラー -->
                        <p th:if="${error}" th:text="${error}" class="text-danger fw-semibold mt-3"></p>

                        <!-- 操作ボタン -->
                        <div class="d-flex justify-content-end gap-2 mt-2">
                            <!-- PENDINGの場合 取り下げボタン -->
                            <form th:if="${leaveRequest.status.name() == 'PENDING'}"
                                th:action="@{/user/leave-requests/withdraw}" method="post"
                                onsubmit="return confirm('本当に休暇申請を取り下げますか？この操作は取り消せません。');">
                                <input type="hidden" name="id" th:value="${leaveRequest.id}" />
                                <button type="submit" class="btn btn-danger">取り下げ</button>
                            </form>

                            <!-- WITHDRAWNの場合 削除ボタン -->
                            <form th:if="${leaveRequest.status.name() == 'WITHDRAWN'}"
                                th:action="@{/user/leave-requests/delete}" method="post"
                                onsubmit="return confirm('本当に休暇申請を削除しますか？この操作は取り消せません。');">
                                <input type="hidden" name="id" th:value="${leaveRequest.id}" />
                                <button type="submit" class="btn btn-danger">削除</button>
                            </form>
                        </div>

                        <!-- 申請日・承認日・却下日 -->
                        <div class="border-top pt-3 mt-4">
                            <p class="small text-muted mb-1">
                                申請日時：
                                <span th:text="${#temporals.format(leaveRequest.appliedAt, 'yyyy-MM-dd HH:mm')}"></span>
                            </p>
                            <p class="small text-muted mb-1" th:if="${leaveRequest.approvedAt != null}">
                                承認日時：
                                <span
                                    th:text="${#temporals.format(leaveRequest.approvedAt, 'yyyy-MM-dd HH:mm')}"></span>
                            </p>
                            <p class="small text-muted mb-1" th:if="${leaveRequest.rejectedAt != null}">
                                却下日時：
                                <span
                                    th:text="${#temporals.format(leaveRequest.rejectedAt, 'yyyy-MM-dd HH:mm')}"></span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 戻るリンク -->
        <div class="text-center mt-4">
            <a th:href="@{/user/leave-requests}" class="btn btn-outline-success px-4">休暇申請一覧に戻る</a>
        </div>
    </div>
</body>

</html>